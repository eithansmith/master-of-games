{{ define "home" }}
    {{ template "base" . }}
{{ end }}

{{ define "main" }}
    <section class="card">
        <h1>Log a game</h1>

        {{ if .FormError }}
            <div class="alert">{{ .FormError }}</div>
        {{ end }}

        <form hx-post="/games" hx-target="#main" hx-swap="innerHTML" method="post" class="form">
            <label>
                Game title
                <select name="title_id" required>
                    <option value="">Select a game...</option>
                    {{ range .Titles }}
                        <option value="{{ .ID }}" {{ if eq $.Form.TitleID .ID }}selected{{ end }}>{{ .Name }}</option>
                    {{ end }}
                </select>
            </label>

            <label>
                Played at
                <input type="datetime-local" name="played_at" required value="{{ .Form.PlayedAt }}">
                <small class="hint">Weekdays only (Mon – Fri)</small>
            </label>

            <div class="grid2">
                <div>
                    <div class="label">Participants</div>
                    <div class="chips">
                        {{ range .Players }}
                            <label class="chip">
                                <input
                                        type="checkbox"
                                        name="participants"
                                        value="{{ .ID }}"
                                        {{ if index $.Form.Participants .ID }}checked{{ end }}
                                >
                                <span>{{ .Name }}</span>
                            </label>
                        {{ end }}
                    </div>
                </div>

                <div>
                    <div class="label">Winners (can be multiple)</div>
                    <div class="chips">
                        {{ range .Players }}
                            <label class="chip">
                                <input
                                        type="checkbox"
                                        name="winners"
                                        value="{{ .ID }}"
                                        {{ if index $.Form.Winners .ID }}checked{{ end }}
                                >
                                <span>{{ .Name }}</span>
                            </label>
                        {{ end }}
                    </div>
                    <small class="hint">Winners must also be selected as participants.</small>
                </div>
            </div>

            <label>
                Notes (optional)
                <textarea name="notes" rows="3" placeholder="Anything noteworthy?">{{ .Form.Notes }}</textarea>
            </label>

            <div class="row">
                <button class="btn" type="submit">Add game</button>
            </div>
        </form>
    </section>

    <section class="card" style="margin-top: 12px;">
        <h1>Recent games</h1>

        {{ if not .Games }}
            <p>No games yet. Log the first one ☝️</p>
        {{ else }}
            <div class="list">
                {{ range .Games }}
                    <div class="list-item">
                        <div class="li-main">
                            <div class="li-title">{{ .Title }}</div>
                            <div class="li-sub">{{ .PlayedAt.Format "2006-01-02 15:04" }}</div>
                            <div class="li-sub">
                                Winners:
                                {{ range $i, $wid := .WinnerIDs }}
                                    {{ if $i }}, {{ end }}
                                    {{ index $.PlayerNames $wid }}
                                {{ end }}
                            </div>
                            {{ if .Notes }}
                                <div class="li-sub">Notes: {{ .Notes }}</div>
                            {{ end }}
                        </div>
                        <form hx-post="/games/delete" hx-target="#main" hx-select="#main" hx-swap="outerHTML"
                              method="post">
                            <input type="hidden" name="id" value="{{ .ID }}">
                            <button class="btn danger" type="submit" title="Delete">Delete</button>
                        </form>
                    </div>
                {{ end }}
            </div>
        {{ end }}
    </section>
{{ end }}
